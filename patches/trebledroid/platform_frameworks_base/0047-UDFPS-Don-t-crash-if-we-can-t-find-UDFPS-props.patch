From e8b03dc5628987bf4de4b6e070008f900d4525f7 Mon Sep 17 00:00:00 2001
From: Pierre-Hugues Husson <phh@phh.me>
Date: Wed, 25 Oct 2023 07:30:45 -0400
Subject: [PATCH] UDFPS Don't crash if we can't find UDFPS props

---
 .../java/com/android/server/biometrics/AuthService.java   | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/services/core/java/com/android/server/biometrics/AuthService.java b/services/core/java/com/android/server/biometrics/AuthService.java
index 2a6ff62c..e850e885 100644
--- a/services/core/java/com/android/server/biometrics/AuthService.java
+++ b/services/core/java/com/android/server/biometrics/AuthService.java
@@ -1023,7 +1023,13 @@ public class AuthService extends SystemService {
                 getWorkaroundSensorProps(getContext());
 
         boolean isUdfps = !ArrayUtils.isEmpty(udfpsProps);
-        if(!isUdfps) udfpsProps = dynamicUdfpsProps();
+        if(!isUdfps) {
+            try {
+                udfpsProps = dynamicUdfpsProps();
+            } catch(Throwable t) {
+                Slog.e("PHH-Enroll", "Failed generating UDFPS props");
+            }
+        }
         isUdfps = !ArrayUtils.isEmpty(udfpsProps);
 
         if(udfpsProps.length > 0) {
-- 
2.40.1

